stages:
  - test
  - report

pytest:
  stage: test
  image: python:3.11
  allow_failure: true 
  script:
    - pip install -r requirements.txt
    - mkdir -p allure-results
    - pytest --alluredir=allure-results || true
  artifacts:
    when: always
    paths:
      - allure-results/
    expire_in: 7 days

allure_report:
  stage: report
  image: allureframework/allure-cli
  script:
    - allure generate allure-results --clean -o allure-report
  artifacts:
    when: always
    paths:
      - allure-report/
    expire_in: 7 days
  dependencies:
    - pytest